<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Đánh Giá Học Sinh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F4F8FF;
        }
        :root {
            --primary-blue: #4A90E2;
            --accent-yellow: #F5A623;
            --text-dark: #4A4A4A;
            --text-light: #9B9B9B;
            --bg-light-blue: #F4F8FF;
            --bg-white: #FFFFFF;
        }
        .bg-primary { background-color: var(--primary-blue); }
        .text-primary { color: var(--primary-blue); }
        .border-primary { border-color: var(--primary-blue); }
        .bg-accent { background-color: var(--accent-yellow); }
        .text-accent { color: var(--accent-yellow); }
        .bg-light { background-color: var(--bg-light-blue); }
        .text-dark { color: var(--text-dark); }
        .text-light { color: var(--text-light); }
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            transition: background-color: 0.3s;
        }
        .btn-primary:hover {
            background-color: #357ABD;
        }
        .btn-accent {
            background-color: var(--accent-yellow);
            color: white;
            transition: background-color: 0.3s;
        }
        .btn-accent:hover {
            background-color: #D9931F;
        }
        .star-rating .star {
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s;
        }
        .star-rating .star.selected, .star-rating:hover .star:hover ~ .star {
            color: #d1d5db;
        }
        .star-rating:hover .star:hover,
        .star-rating .star.selected {
            color: var(--accent-yellow) !important;
        }
        .star-rating.rating-1 .star:nth-child(-n+1) { color: #F87171; }
        .star-rating.rating-2 .star:nth-child(-n+2) { color: #4ADE80; }
        .star-rating.rating-3 .star:nth-child(-n+3) { color: var(--accent-yellow); }

        .screen { display: none; }
        .screen.active { display: block; }

        /* Sidebar styles */
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #4A4A4A;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        .sidebar-link:hover {
            background-color: #EBF2FF;
            color: var(--primary-blue);
        }
        .sidebar-link.active {
            background-color: var(--primary-blue);
            color: white;
            font-weight: 600;
        }
        .sidebar-link.active i {
            color: white !important;
        }
        .sidebar-link i {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
            color: #9B9B9B;
            transition: color 0.2s;
        }
        .table-action-btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        .year-item {
            cursor: pointer;
        }
        .year-item.active {
            background-color: var(--bg-light-blue);
            font-weight: 600;
            color: var(--primary-blue);
        }
         .tab-button { padding: 0.5rem 1rem; border-bottom: 2px solid transparent; font-weight: 500; color: var(--text-light); transition: all 0.2s; }
        .tab-button:hover { color: var(--primary-blue); }
        .tab-button.active { color: var(--primary-blue); border-bottom-color: var(--primary-blue); font-weight: 600; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        
        /* Report Preview Styles */
        .report-cell {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            vertical-align: top;
        }
        .report-header {
            font-weight: bold;
            background-color: #f9fafb;
        }
        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 10;
        }
        .sticky-col-2 {
            position: sticky;
            left: 150px; /* Adjust based on the width of the first sticky column */
            z-index: 10;
        }
        .evaluation-table th, .evaluation-table td {
            white-space: normal; /* Allow text wrapping */
        }
        .disabled-ui {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
    </style>
</head>
<body class="text-dark">

    <!-- Main Application Container -->
    <div id="app-container" class="hidden">
        <div class="flex h-screen bg-light">
            <!-- SIDEBAR -->
            <aside id="sidebar" class="w-64 bg-white p-4 flex-shrink-0 border-r">
                <!-- Logo -->
                 <div class="flex items-center space-x-3 mb-8 px-2">
                    <img src="logo.png" alt="School Logo" class="w-10 h-10 rounded-lg">
                    <span class="font-bold text-xl text-primary">Tuệ Đức Pathway School</span>
                </div>
                <!-- Navigation -->
                <nav id="sidebar-nav" class="space-y-2">
                    <a href="#" class="sidebar-link" data-screen="dashboard" data-role="admin chuyen_mon">
                        <i data-lucide="layout-dashboard"></i> Bảng điều khiển
                    </a>
                    
                    <!-- Admin & Chuyen Mon Only -->
                    <div data-role="admin chuyen_mon" class="role-menu">
                        <p class="px-2 text-xs font-semibold text-light uppercase tracking-wider mt-4 mb-2">Quản trị</p>
                        <a href="#" class="sidebar-link" data-screen="student-management" data-role="admin chuyen_mon">
                            <i data-lucide="users"></i> Quản lý Học sinh
                        </a>
                         <a href="#" class="sidebar-link" data-screen="class-management" data-role="admin chuyen_mon">
                            <i data-lucide="school"></i> Quản lý Lớp học
                        </a>
                         <a href="#" class="sidebar-link" data-screen="teacher-management" data-role="admin chuyen_mon">
                            <i data-lucide="user-cog"></i> Quản lý Giáo viên
                        </a>
                        <a href="#" class="sidebar-link" data-screen="facility-management" data-role="admin chuyen_mon">
                            <i data-lucide="building"></i> Quản lý Cơ sở
                        </a>
                         <a href="#" class="sidebar-link" data-screen="academic-management" data-role="admin chuyen_mon">
                            <i data-lucide="calendar-days"></i> Năm học & Kỳ
                        </a>
                        <a href="#" class="sidebar-link" data-screen="academic-subject-management" data-role="admin chuyen_mon">
                            <i data-lucide="book-copy"></i> Quản lý Môn học VH
                        </a>
                        <a href="#" class="sidebar-link" data-screen="skill-subject-management" data-role="admin chuyen_mon">
                            <i data-lucide="book-marked"></i> Quản lý Môn Kỹ năng
                        </a>
                    </div>
                    
                    <!-- Teacher (GVCN/GVTA) & Skill Teacher (GVKN) -->
                    <div data-role="teacher teacher_english skill_teacher" class="role-menu">
                        <p class="px-2 text-xs font-semibold text-light uppercase tracking-wider mt-4 mb-2">Giáo viên</p>
                        <a href="#" class="sidebar-link" data-screen="class-setup" data-role="teacher teacher_english skill_teacher">
                            <i data-lucide="clipboard-list"></i> Thiết lập Lớp học
                        </a>
                        <a href="#" class="sidebar-link" data-screen="evaluation-input" data-role="teacher teacher_english skill_teacher">
                            <i data-lucide="edit-3"></i> Nhập Đánh giá
                        </a>
                        <a href="#" class="sidebar-link" data-screen="report-export" data-role="teacher teacher_english skill_teacher">
                            <i data-lucide="file-output"></i> Xuất Báo cáo
                        </a>
                    </div>
                </nav>
            </aside>
            
            <div class="flex-1 flex flex-col overflow-hidden">
                <!-- HEADER -->
                <header class="bg-white shadow-md">
                    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-end h-16">
                            <!-- Right: User Menu -->
                            <div class="flex items-center space-x-4">
                                <div id="admin-switcher" class="hidden items-center space-x-2">
                                     <i data-lucide="building-2" class="w-5 h-5 text-gray-500"></i>
                                     <select class="border-none bg-transparent text-sm font-medium focus:ring-0">
                                         <option>Cơ sở A (Hiện tại)</option>
                                         <option>Cơ sở B</option>
                                     </select>
                                </div>
                                <button class="relative p-2 rounded-full hover:bg-gray-100">
                                    <i data-lucide="bell" class="w-6 h-6 text-gray-600"></i>
                                    <span class="absolute top-2 right-2 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
                                </button>
                                <div class="relative">
                                    <button id="user-menu-button" class="flex items-center space-x-2">
                                        <img class="h-9 w-9 rounded-full object-cover" src="https://placehold.co/100x100/4A90E2/FFFFFF?text=A" alt="User avatar">
                                        <div class="text-left hidden sm:block">
                                            <p id="user-name" class="font-semibold text-sm text-dark">Nguyễn Văn A</p>
                                            <p id="user-role" class="text-xs text-light">GVCN</p>
                                        </div>
                                    </button>
                                    <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 hidden">
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Thông tin tài khoản</a>
                                        <a href="#" id="logout-button" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Đăng xuất</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- MAIN CONTENT -->
                <main class="flex-1 overflow-x-hidden overflow-y-auto bg-light">
                    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                        <!-- Dashboard Screen (Admin) -->
                        <div id="dashboard-admin" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Bảng điều khiển - Ban Giám hiệu</h1>
                             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                 <div class="bg-white p-6 rounded-lg shadow flex items-center space-x-4"><div class="bg-blue-100 p-3 rounded-full"><i data-lucide="users" class="w-6 h-6 text-blue-600"></i></div><div><p class="text-sm text-light">Tổng số giáo viên</p><p class="text-2xl font-bold">125</p></div></div>
                                 <div class="bg-white p-6 rounded-lg shadow flex items-center space-x-4"><div class="bg-green-100 p-3 rounded-full"><i data-lucide="user-check" class="w-6 h-6 text-green-600"></i></div><div><p class="text-sm text-light">Tổng số học sinh</p><p class="text-2xl font-bold">1,560</p></div></div>
                                 <div class="bg-white p-6 rounded-lg shadow flex items-center space-x-4"><div class="bg-yellow-100 p-3 rounded-full"><i data-lucide="check-circle-2" class="w-6 h-6 text-yellow-600"></i></div><div><p class="text-sm text-light">Lớp đã hoàn thành</p><p class="text-2xl font-bold">85%</p></div></div>
                                 <div class="bg-white p-6 rounded-lg shadow flex items-center space-x-4"><div class="bg-purple-100 p-3 rounded-full"><i data-lucide="building" class="w-6 h-6 text-purple-600"></i></div><div><p class="text-sm text-light">Số cơ sở</p><p class="text-2xl font-bold">3</p></div></div>
                            </div>
                            
                            <!-- Filters -->
                            <div class="bg-white p-4 rounded-lg shadow mb-6">
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                                    <div>
                                        <label for="filter-year" class="text-xs font-medium text-gray-500">Năm học</label>
                                        <select id="filter-year" class="w-full mt-1 p-2 border rounded-md text-sm focus:ring-primary focus:border-primary"><option>2024-2025</option><option>2023-2024</option></select>
                                    </div>
                                    <div>
                                        <label for="filter-term" class="text-xs font-medium text-gray-500">Học kỳ</label>
                                        <select id="filter-term" class="w-full mt-1 p-2 border rounded-md text-sm focus:ring-primary focus:border-primary"><option>Tất cả</option><option>Học kỳ I</option><option>Học kỳ II</option></select>
                                    </div>
                                    <div>
                                        <label for="filter-month" class="text-xs font-medium text-gray-500">Tháng</label>
                                        <select id="filter-month" class="w-full mt-1 p-2 border rounded-md text-sm focus:ring-primary focus:border-primary"><option>Tất cả</option><option>Tháng 9</option><option>Tháng 10</option></select>
                                    </div>
                                    <div>
                                        <label for="filter-class" class="text-xs font-medium text-gray-500">Lớp</label>
                                        <select id="filter-class" class="w-full mt-1 p-2 border rounded-md text-sm focus:ring-primary focus:border-primary"><option>Tất cả</option><option>Lớp 10A1</option><option>Lớp 10A2</option></select>
                                    </div>
                                    <div>
                                        <label for="filter-teacher" class="text-xs font-medium text-gray-500">Giáo viên</label>
                                        <select id="filter-teacher" class="w-full mt-1 p-2 border rounded-md text-sm focus:ring-primary focus:border-primary"><option>Tất cả</option><option>Nguyễn Thị C</option><option>Lê Văn D</option></select>
                                    </div>
                                </div>
                            </div>

                            <!-- Charts Section -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <h2 class="font-bold mb-2 text-dark">Đánh giá học sinh theo lớp</h2>
                                    <p class="text-sm text-light mb-4">So sánh tỷ lệ phân loại giữa các lớp.</p>
                                    <canvas id="evaluationByClassChart"></canvas>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <h2 class="font-bold mb-2 text-dark">Số lượng lớp học của giáo viên</h2>
                                    <p class="text-sm text-light mb-4">Thống kê số lớp mỗi giáo viên đang chủ nhiệm.</p>
                                    <canvas id="classesPerTeacherChart"></canvas>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <h2 class="font-bold mb-2 text-dark">Phân bổ học sinh theo giáo viên</h2>
                                    <p class="text-sm text-light mb-4">Tỷ lệ học sinh được phân công cho mỗi giáo viên.</p>
                                    <canvas id="studentsPerTeacherChart"></canvas>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <h2 class="font-bold mb-2 text-dark">Phân loại đánh giá theo giáo viên</h2>
                                    <p class="text-sm text-light mb-4">Chất lượng đánh giá của từng giáo viên.</p>
                                    <canvas id="evaluationByTeacherChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Student Management Screen (Admin) -->
                        <div id="student-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Học sinh</h1>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                                    <div class="relative w-full sm:w-1/3">
                                        <input type="text" placeholder="Tìm kiếm học sinh..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                                    </div>
                                    <div class="flex space-x-3">
                                        <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="student"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm mới</span></button>
                                        <button id="import-student-btn" class="btn-accent py-2 px-4 rounded-lg flex items-center space-x-2"><i data-lucide="upload" class="w-5 h-5"></i><span>Import</span></button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3">STT</th>
                                                <th class="px-6 py-3">Mã HS</th>
                                                <th class="px-6 py-3">Họ và tên</th>
                                                <th class="px-6 py-3">Ngày sinh</th>
                                                <th class="px-6 py-3">Lớp</th>
                                                <th class="px-6 py-3 text-center">Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4">HS001</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">Lê An</td>
                                                <td class="px-6 py-4">15/05/2010</td>
                                                <td class="px-6 py-4">10A1</td>
                                                <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                    <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="student"><i data-lucide="edit"></i></button>
                                                    <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Class Management Screen (Admin) -->
                        <div id="class-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Lớp học</h1>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold">Danh sách Lớp học</h2>
                                    <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="class"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm mới</span></button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3">STT</th>
                                                <th class="px-6 py-3">Tên lớp</th>
                                                <th class="px-6 py-3">GVCN</th>
                                                <th class="px-6 py-3">Sĩ số</th>
                                                <th class="px-6 py-3 text-center">Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">10A1</td>
                                                <td class="px-6 py-4">Nguyễn Thị C</td>
                                                <td class="px-6 py-4">45</td>
                                                <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                    <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="class"><i data-lucide="edit"></i></button>
                                                    <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Teacher Management Screen (Admin) -->
                        <div id="teacher-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Giáo viên</h1>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold">Danh sách Giáo viên</h2>
                                    <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="teacher"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm mới</span></button>
                                </div>
                                 <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3">STT</th>
                                                <th class="px-6 py-3">Họ và tên</th>
                                                <th class="px-6 py-3">Email</th>
                                                <th class="px-6 py-3">Vai trò</th>
                                                <th class="px-6 py-3 text-center">Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">Nguyễn Thị C</td>
                                                <td class="px-6 py-4">ntc@email.com</td>
                                                <td class="px-6 py-4">GVCN</td>
                                                <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                    <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="teacher"><i data-lucide="edit"></i></button>
                                                    <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Facility Management Screen (Admin) -->
                        <div id="facility-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Cơ sở</h1>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold">Danh sách Cơ sở</h2>
                                    <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="facility"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm mới</span></button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3">STT</th>
                                                <th class="px-6 py-3">Tên Cơ sở</th>
                                                <th class="px-6 py-3">Địa chỉ</th>
                                                <th class="px-6 py-3">Số điện thoại</th>
                                                <th class="px-6 py-3 text-center">Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">Cơ sở A - Quận 1</td>
                                                <td class="px-6 py-4">123 Nguyễn Huệ, P. Bến Nghé, Quận 1, TP.HCM</td>
                                                <td class="px-6 py-4">028 1234 5678</td>
                                                <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                    <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="facility"><i data-lucide="edit"></i></button>
                                                    <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Academic Management Screen (Admin) -->
                        <div id="academic-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Năm học & Kỳ đánh giá</h1>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Left Column: Academic Years -->
                                <div class="md:col-span-1 bg-white p-6 rounded-lg shadow">
                                    <div class="flex justify-between items-center mb-4">
                                        <h2 class="text-lg font-semibold">Năm học</h2>
                                        <button class="btn-primary py-1 px-3 rounded-lg flex items-center space-x-2 text-sm add-new-btn" data-type="year"><i data-lucide="plus" class="w-4 h-4"></i><span>Thêm</span></button>
                                    </div>
                                    <ul id="year-list" class="space-y-2">
                                        <li class="year-item flex justify-between items-center p-3 rounded-lg active">
                                            <span>2024 - 2025</span>
                                            <div class="flex items-center space-x-1">
                                                <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="year"><i data-lucide="edit" class="w-4 h-4"></i></button>
                                                <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                            </div>
                                        </li>
                                        <li class="year-item flex justify-between items-center p-3 rounded-lg">
                                            <span>2023 - 2024</span>
                                            <div class="flex items-center space-x-1">
                                                <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="year"><i data-lucide="edit" class="w-4 h-4"></i></button>
                                                <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <!-- Right Column: Terms -->
                                <div class="md:col-span-2 bg-white p-6 rounded-lg shadow">
                                    <div class="flex justify-between items-center mb-4">
                                        <h2 class="text-lg font-semibold">Các kỳ trong năm <span id="selected-year-title" class="text-primary">2024 - 2025</span></h2>
                                        <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="term"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm kỳ mới</span></button>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                <tr>
                                                    <th class="px-6 py-3">Tên kỳ đánh giá</th>
                                                    <th class="px-6 py-3">Ngày bắt đầu</th>
                                                    <th class="px-6 py-3">Ngày kết thúc</th>
                                                    <th class="px-6 py-3 text-center">Hành động</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="bg-white border-b hover:bg-gray-50">
                                                    <td class="px-6 py-4 font-medium">Đánh giá tháng 9</td>
                                                    <td class="px-6 py-4">01/09/2024</td>
                                                    <td class="px-6 py-4">30/09/2024</td>
                                                    <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                        <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="term"><i data-lucide="edit"></i></button>
                                                        <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Academic Subject Management Screen (Admin) -->
                        <div id="academic-subject-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Môn học Văn hóa & Tiêu chí</h1>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Left Column: Academic Subjects -->
                                <div class="md:col-span-1 bg-white p-6 rounded-lg shadow">
                                    <div class="flex justify-between items-center mb-4">
                                        <h2 class="text-lg font-semibold">Môn học</h2>
                                        <button class="btn-primary py-1 px-3 rounded-lg flex items-center space-x-2 text-sm add-new-btn" data-type="academic_subject"><i data-lucide="plus" class="w-4 h-4"></i><span>Thêm</span></button>
                                    </div>
                                    <ul class="space-y-2">
                                        <li class="year-item flex justify-between items-center p-3 rounded-lg active">
                                            <span>Toán</span>
                                            <div class="flex items-center space-x-1">
                                                <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="academic_subject"><i data-lucide="edit" class="w-4 h-4"></i></button>
                                                <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                            </div>
                                        </li>
                                        <li class="year-item flex justify-between items-center p-3 rounded-lg">
                                            <span>Khoa học - Lịch sử - Địa lý</span>
                                            <div class="flex items-center space-x-1">
                                                <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="academic_subject"><i data-lucide="edit" class="w-4 h-4"></i></button>
                                                <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                                <!-- Right Column: Criteria -->
                                <div class="md:col-span-2 bg-white p-6 rounded-lg shadow">
                                    <div class="flex justify-between items-center mb-4">
                                        <h2 class="text-lg font-semibold">Các tiêu chí cho môn <span class="text-primary">Toán</span></h2>
                                        <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="subject_criteria"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm Tiêu chí</span></button>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                <tr>
                                                    <th class="px-6 py-3">Tên Tiêu chí</th>
                                                    <th class="px-6 py-3 text-center">Hành động</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="bg-white border-b hover:bg-gray-50">
                                                    <td class="px-6 py-4 font-medium">Tính toán nhanh và chính xác</td>
                                                    <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                        <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="subject_criteria"><i data-lucide="edit"></i></button>
                                                        <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                    </td>
                                                </tr>
                                                 <tr class="bg-white border-b hover:bg-gray-50">
                                                    <td class="px-6 py-4 font-medium">Bảng nhân, chia 2 và 5</td>
                                                    <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                        <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="subject_criteria"><i data-lucide="edit"></i></button>
                                                        <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Skill Subject Management Screen (Admin) -->
                        <div id="skill-subject-management" class="screen">
                            <h1 class="text-2xl font-bold text-dark mb-6">Quản lý Môn học Kỹ năng</h1>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold">Danh sách Môn học</h2>
                                    <button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2 add-new-btn" data-type="skill_subject"><i data-lucide="plus" class="w-5 h-5"></i><span>Thêm mới</span></button>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3">STT</th>
                                                <th class="px-6 py-3">Tên Môn học</th>
                                                <th class="px-6 py-3 text-center">Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">1</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">GIÁO DỤC CẢM XÚC</td>
                                                <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                    <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="skill_subject"><i data-lucide="edit"></i></button>
                                                    <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                </td>
                                            </tr>
                                            <tr class="bg-white border-b hover:bg-gray-50">
                                                <td class="px-6 py-4">2</td>
                                                <td class="px-6 py-4 font-medium text-gray-900">TIN HỌC</td>
                                                <td class="px-6 py-4 flex justify-center items-center space-x-2">
                                                    <button class="table-action-btn hover:bg-blue-100 text-blue-600 edit-btn" data-type="skill_subject"><i data-lucide="edit"></i></button>
                                                    <button class="table-action-btn hover:bg-red-100 text-red-600 delete-btn"><i data-lucide="trash-2"></i></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Class Setup Screen (Teacher) -->
                        <div id="class-setup" class="screen">
                             <h1 id="class-setup-title" class="text-2xl font-bold text-dark mb-6">Thiết lập Lớp học</h1>
                             <div id="gvkn-class-filter" class="hidden mb-6 bg-white p-4 rounded-lg shadow">
                                 <label for="gvkn-class-select" class="block text-sm font-medium text-gray-700">Chọn lớp giảng dạy:</label>
                                 <select id="gvkn-class-select" class="mt-1 block w-full md:w-1/3 p-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                     <option value="">-- Vui lòng chọn lớp --</option>
                                     <option value="10A1">Lớp 10A1</option>
                                     <option value="11B2">Lớp 11B2</option>
                                     <option value="12C3">Lớp 12C3</option>
                                 </select>
                             </div>
                             <div id="class-setup-content" class="hidden space-y-6">
                                 <div class="bg-white p-6 rounded-lg shadow">
                                     <div class="border-b border-gray-200 mb-4">
                                         <nav class="class-setup-tabs flex space-x-6" aria-label="Tabs">
                                             <button class="tab-button active" data-tab="tab-assignment">Phân nhóm & Phân công Nhiệm vụ</button>
                                             <button class="tab-button" data-tab="tab-planning">Kế hoạch Rèn luyện theo Nhóm</button>
                                         </nav>
                                     </div>

                                     <!-- Tab 1: Group & Task Assignment -->
                                     <div class="tab-panel active" id="tab-assignment">
                                        <div class="flex justify-end mb-4">
                                            <button class="btn-accent py-2 px-4 rounded-lg flex items-center space-x-2 text-sm"><i data-lucide="upload" class="w-4 h-4"></i><span>Import Phân nhóm</span></button>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm text-left">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                    <tr>
                                                        <th class="px-6 py-3">STT</th>
                                                        <th class="px-6 py-3">Họ và tên</th>
                                                        <th class="px-6 py-3">Phân nhóm</th>
                                                        <th class="px-6 py-3">Phân công Nhiệm vụ</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">1</td>
                                                        <td class="px-6 py-4 font-medium text-gray-900">Lê An</td>
                                                        <td class="px-6 py-4">
                                                            <select class="p-2 border rounded-md w-full text-sm focus:ring-primary focus:border-primary">
                                                                <option>Chưa phân nhóm</option>
                                                                <option selected>Nhóm 1</option>
                                                                <option>Nhóm 2</option>
                                                                <option>Nhóm 3</option>
                                                                <option>Nhóm 4</option>
                                                                <option>Nhóm 5</option>
                                                            </select>
                                                        </td>
                                                        <td class="px-6 py-4">
                                                            <select class="p-2 border rounded-md w-full text-sm focus:ring-primary focus:border-primary">
                                                                <option>Không có</option>
                                                                <option selected>Lớp trưởng</option>
                                                                <option>Lớp phó</option>
                                                                <option>Tổ trưởng</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">2</td>
                                                        <td class="px-6 py-4 font-medium text-gray-900">Nguyễn Văn B</td>
                                                        <td class="px-6 py-4">
                                                            <select class="p-2 border rounded-md w-full text-sm focus:ring-primary focus:border-primary">
                                                                <option>Chưa phân nhóm</option>
                                                                <option selected>Nhóm 1</option>
                                                                <option>Nhóm 2</option>
                                                                <option>Nhóm 3</option>
                                                                <option>Nhóm 4</option>
                                                                <option>Nhóm 5</option>
                                                            </select>
                                                        </td>
                                                        <td class="px-6 py-4">
                                                            <select class="p-2 border rounded-md w-full text-sm focus:ring-primary focus:border-primary">
                                                                <option selected>Không có</option>
                                                                <option>Lớp trưởng</option>
                                                                <option>Lớp phó</option>
                                                                <option>Tổ trưởng</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr class="bg-white border-b hover:bg-gray-50">
                                                        <td class="px-6 py-4">3</td>
                                                        <td class="px-6 py-4 font-medium text-gray-900">Trần Bình</td>
                                                        <td class="px-6 py-4">
                                                            <select class="p-2 border rounded-md w-full text-sm focus:ring-primary focus:border-primary">
                                                                <option>Chưa phân nhóm</option>
                                                                <option>Nhóm 1</option>
                                                                <option selected>Nhóm 2</option>
                                                                <option>Nhóm 3</option>
                                                                <option>Nhóm 4</option>
                                                                <option>Nhóm 5</option>
                                                            </select>
                                                        </td>
                                                        <td class="px-6 py-4">
                                                            <select class="p-2 border rounded-md w-full text-sm focus:ring-primary focus:border-primary">
                                                                <option>Không có</option>
                                                                <option>Lớp trưởng</option>
                                                                <option selected>Lớp phó</option>
                                                                <option>Tổ trưởng</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                     </div>

                                     <!-- Tab 2: Group Training Plan -->
                                     <div class="tab-panel" id="tab-planning">
                                        <p class="text-sm text-light mb-4">Lập kế hoạch rèn luyện chi tiết cho từng học sinh trong mỗi nhóm.</p>
                                        <div class="space-y-6">
                                            <!-- Group 1 -->
                                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                                <h4 class="font-bold text-lg mb-4 text-primary">Kế hoạch rèn luyện - NHÓM 1</h4>
                                                <div class="overflow-x-auto">
                                                    <table class="w-full text-sm">
                                                        <thead class="text-xs text-gray-700 uppercase bg-gray-200">
                                                            <tr>
                                                                <th class="px-4 py-3 w-[18%]">Họ và tên</th>
                                                                <th class="px-4 py-3 w-[18%]">Thái độ</th>
                                                                <th class="px-4 py-3 w-[18%]">Kỹ năng</th>
                                                                <th class="px-4 py-3 w-[18%]">Hành vi</th>
                                                                <th class="px-4 py-3 w-[28%]">Ghi chú</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr class="bg-white border-b">
                                                                <td class="px-4 py-2 font-medium text-gray-900">Lê An</td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Ghi chú..."></textarea></td>
                                                            </tr>
                                                            <tr class="bg-white border-b">
                                                                <td class="px-4 py-2 font-medium text-gray-900">Nguyễn Văn B</td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Ghi chú..."></textarea></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <!-- Group 2 -->
                                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                                <h4 class="font-bold text-lg mb-4 text-primary">Kế hoạch rèn luyện - NHÓM 2</h4>
                                                <div class="overflow-x-auto">
                                                    <table class="w-full text-sm">
                                                        <thead class="text-xs text-gray-700 uppercase bg-gray-200">
                                                            <tr>
                                                                <th class="px-4 py-3 w-[18%]">Họ và tên</th>
                                                                <th class="px-4 py-3 w-[18%]">Thái độ</th>
                                                                <th class="px-4 py-3 w-[18%]">Kỹ năng</th>
                                                                <th class="px-4 py-3 w-[18%]">Hành vi</th>
                                                                <th class="px-4 py-3 w-[28%]">Ghi chú</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr class="bg-white border-b">
                                                                <td class="px-4 py-2 font-medium text-gray-900">Trần Bình</td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Nhận xét..."></textarea></td>
                                                                <td class="p-2"><textarea class="w-full h-20 p-1 border rounded-md text-xs" placeholder="Ghi chú..."></textarea></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                     </div>
                                 </div>
                             </div>
                        </div>

                        <!-- Evaluation Input Screen -->
                        <div id="evaluation-input" class="screen">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                                <div><h1 class="text-2xl font-bold text-dark">Nhập đánh giá</h1><p class="text-light">Chọn lớp và kỳ để bắt đầu nhập liệu.</p></div>
                                <div class="flex space-x-3 mt-4 md:mt-0"><button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2"><i data-lucide="download" class="w-5 h-5"></i><span>Tải file Excel</span></button><button class="btn-accent py-2 px-4 rounded-lg flex items-center space-x-2"><i data-lucide="upload" class="w-5 h-5"></i><span>Tải lên kết quả</span></button></div>
                            </div>
                            <!-- GVCN View -->
                            <div id="gvcn-evaluation-view" class="evaluation-view hidden space-y-6">
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <div class="border-b border-gray-200 mb-6">
                                        <nav class="evaluation-tabs flex space-x-6" aria-label="Tabs">
                                            <button class="tab-button active" data-tab="tab-nlpc">Đánh giá Năng lực & Phẩm chất</button>
                                            <button class="tab-button" data-tab="tab-3-goc">Đánh giá 3 Gốc</button>
                                            <button class="tab-button" data-tab="tab-van-hoa">Đánh giá Văn hóa & Năng lực</button>
                                        </nav>
                                    </div>

                                    <!-- Competency and Quality Evaluation Panel (Horizontal) -->
                                    <div class="tab-panel active" id="tab-nlpc">
                                        <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                                            <h3 class="font-semibold text-lg">Đánh giá Năng lực & Phẩm chất - Lớp 12A3</h3>
                                            <div class="flex items-center gap-4">
                                                <div>
                                                    <label for="group-filter" class="text-sm font-medium mr-2">Lọc theo nhóm:</label>
                                                    <select id="group-filter" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                        <option value="all">Tất cả các nhóm</option>
                                                        <option value="1">Nhóm 1</option>
                                                        <option value="2">Nhóm 2</option>
                                                        <option value="3">Nhóm 3</option>
                                                        <option value="4">Nhóm 4</option>
                                                        <option value="5">Nhóm 5</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label for="week-select" class="text-sm font-medium mr-2">Chọn tuần:</label>
                                                    <select id="week-select" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                        <option>Tuần 1 (19/08 - 23/08)</option>
                                                        <option>Tuần 2 (26/08 - 30/08)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-xs border-collapse border border-gray-300 evaluation-table">
                                                <thead class="bg-gray-100 text-center font-semibold">
                                                    <tr>
                                                        <th class="border border-gray-300 p-2 sticky-col bg-gray-100 w-[150px]">Năng lực/Phẩm chất</th>
                                                        <th class="border border-gray-300 p-2 sticky-col-2 bg-gray-100 w-[250px]">Biểu hiện hành vi</th>
                                                        <th class="border border-gray-300 p-2 min-w-[100px]">Lê An</th>
                                                        <th class="border border-gray-300 p-2 min-w-[100px]">Nguyễn Văn B</th>
                                                        <th class="border border-gray-300 p-2 min-w-[100px]">Trần Bình</th>
                                                        <!-- Add more student headers as needed -->
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Category 1 -->
                                                    <tr class="font-bold bg-gray-200">
                                                        <td class="border border-gray-300 p-2 sticky-col bg-gray-200" colspan="2">1. Tự phục vụ, tự quản</td>
                                                        <td class="border border-gray-300 p-1 text-center text-green-600">T</td>
                                                        <td class="border border-gray-300 p-1 text-center text-green-600">T</td>
                                                        <td class="border border-gray-300 p-1 text-center text-blue-600">Đ</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">tự vệ sinh thân thể, ăn, mặc gọn gàng sạch sẽ</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option selected>2</option><option>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option selected>1</option><option>2</option><option>3</option></select></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">tự chuẩn bị đồ dùng học tập cá nhân ở trên lớp, ở nhà</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option selected>2</option><option>3</option></select></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">giờ nào việc đó theo thời khóa biểu ở trường</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                    </tr>
                                                    <!-- Category 2 -->
                                                    <tr class="font-bold bg-gray-200">
                                                        <td class="border border-gray-300 p-2 sticky-col bg-gray-200" colspan="2">2. Hợp tác</td>
                                                        <td class="border border-gray-300 p-1 text-center text-green-600">T</td>
                                                        <td class="border border-gray-300 p-1 text-center text-blue-600">Đ</td>
                                                        <td class="border border-gray-300 p-1 text-center text-green-600">T</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">tích cực, tự giác hoàn thành công việc được nhóm giao đúng hẹn</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option selected>2</option><option>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">biết lắng nghe và tôn trọng ý kiến khác của các bạn trong nhóm</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option selected>2</option><option>3</option></select></td>
                                                    </tr>
                                                    <!-- Category 3 -->
                                                    <tr class="font-bold bg-gray-200">
                                                        <td class="border border-gray-300 p-2 sticky-col bg-gray-200" colspan="2">3. Tự học và giải quyết vấn đề</td>
                                                        <td class="border border-gray-300 p-1 text-center text-green-600">T</td>
                                                        <td class="border border-gray-300 p-1 text-center text-blue-600">Đ</td>
                                                        <td class="border border-gray-300 p-1 text-center text-green-600">T</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">tự giác, chủ động hoàn thành các nhiệm vụ học tập</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option selected>2</option><option>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">để giải quyết một vấn đề, HS thường cố gắng đến cùng</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option selected>2</option><option>3</option></select></td>
                                                    </tr>
                                                    <tr>
                                                        <td class="border border-gray-300 p-2 sticky-col bg-white"></td>
                                                        <td class="border border-gray-300 p-2 sticky-col-2 bg-white">chủ động nghĩ ra những cách khác nhau để giải quyết vấn đề</td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                        <td class="border border-gray-300 p-1 text-center"><select class="w-full border-none text-xs bg-transparent"><option>1</option><option>2</option><option selected>3</option></select></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- 3 Goc -->
                                    <div class="tab-panel" id="tab-3-goc">
                                        <div class="bg-white rounded-lg overflow-x-auto">
                                            <h3 class="font-semibold mb-4">Đánh giá 3 Gốc - Lớp 12A3</h3>
                                            <table class="w-full text-sm whitespace-nowrap">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                    <tr>
                                                        <th class="px-4 py-3 sticky-col bg-gray-50">Họ và tên</th>
                                                        <th class="px-4 py-3">Tuần 1</th>
                                                        <th class="px-4 py-3">Tuần 2</th>
                                                        <th class="px-4 py-3">Tuần 3</th>
                                                        <th class="px-4 py-3">Tuần 4</th>
                                                        <th class="px-4 py-3">Tuần 5</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="bg-gray-100 font-semibold"><td class="px-4 py-2 sticky-col bg-gray-100" colspan="6">NHÓM 1</td></tr>
                                                    <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Lê An</td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td></tr>
                                                    <tr class="bg-gray-100 font-semibold"><td class="px-4 py-2 sticky-col bg-gray-100" colspan="6">NHÓM 2</td></tr>
                                                    <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Trần Bình</td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!-- Van hoa -->
                                    <div class="tab-panel" id="tab-van-hoa">
                                        <div class="flex items-center gap-4 mb-4">
                                            <label for="academic-subject-filter" class="text-sm font-medium">Chọn môn học:</label>
                                            <select id="academic-subject-filter" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                <option value="">-- Vui lòng chọn môn --</option>
                                                <option value="toan">Toán</option>
                                                <option value="khlsdl">Khoa học - Lịch sử - Địa lý</option>
                                            </select>
                                        </div>
                                        <div id="academic-evaluation-content" class="hidden">
                                            <h4 id="academic-evaluation-subject-title" class="font-bold text-lg mb-4 text-primary"></h4>
                                            <div class="overflow-x-auto">
                                                <!-- Table for Math -->
                                                <table id="academic-table-toan" class="academic-subject-table w-full text-sm whitespace-nowrap">
                                                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                        <tr>
                                                            <th class="px-4 py-3 sticky-col bg-gray-50 w-[300px]">Tiêu chí</th>
                                                            <th class="px-4 py-3">Lê An</th>
                                                            <th class="px-4 py-3">Trần Bình</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Tính toán nhanh và chính xác</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                                        <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Bảng nhân, chia 2 và 5</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                                        <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Toán giải</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                                    </tbody>
                                                </table>
                                                <!-- Table for Science - History - Geography -->
                                                <table id="academic-table-khlsdl" class="academic-subject-table hidden w-full text-sm whitespace-nowrap">
                                                     <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                        <tr>
                                                            <th class="px-4 py-3 sticky-col bg-gray-50 w-[300px]">Tiêu chí</th>
                                                            <th class="px-4 py-3">Lê An</th>
                                                            <th class="px-4 py-3">Trần Bình</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Tên gọi và nơi sống của động, thực vật đặc trưng.</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                                        <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Việc làm thay đổi môi trường sống của động, thực vật.</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- GVKN View -->
                             <div id="gvkn-evaluation-view" class="evaluation-view hidden space-y-6">
                                 <div class="bg-white p-6 rounded-lg shadow">
                                    <h3 class="font-semibold text-lg mb-4">Đánh giá Kỹ năng - Lớp 12A3</h3>
                                    <div class="flex items-center gap-4 mb-4">
                                        <div>
                                            <label for="skill-subject-filter" class="text-sm font-medium mr-2">Chọn môn học:</label>
                                            <select id="skill-subject-filter" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                <option value="">-- Vui lòng chọn môn --</option>
                                                <option value="giao-duc-cam-xuc">GIÁO DỤC CẢM XÚC</option>
                                                <option value="my-thuat-cong-nghe">MỸ THUẬT/ CÔNG NGHỆ</option>
                                                <option value="giao-duc-the-chat">GIÁO DỤC THỂ CHẤT</option>
                                                <option value="tin-hoc">TIN HỌC</option>
                                                <option value="vo-thuat">VÕ THUẬT</option>
                                                <option value="boi-lan">BƠI - LẶN</option>
                                                <option value="sinh-ton">SINH TỒN</option>
                                                <option value="am-nhac">ÂM NHẠC</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="skill-evaluation-content" class="hidden">
                                        <h4 id="skill-evaluation-subject-title" class="font-bold text-lg mb-4 text-primary"></h4>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm whitespace-nowrap">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                    <tr>
                                                        <th class="px-4 py-3 sticky-col bg-gray-50">Học sinh</th>
                                                        <th class="px-4 py-3">Tiếp thu kiến thức</th>
                                                        <th class="px-4 py-3">Kỹ năng thực hành</th>
                                                        <th class="px-4 py-3">Thái độ học tập</th>
                                                        <th class="px-4 py-3">Nhận xét chung</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Lê An</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td></tr>
                                                    <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Trần Bình</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td class="text-center"><button class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="message-square-plus" class="w-5 h-5 text-gray-500"></i></button></td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                 </div>
                             </div>
                             <!-- GVTA View -->
                             <div id="gvta-evaluation-view" class="evaluation-view hidden space-y-6">
                                 <div class="bg-white p-6 rounded-lg shadow">
                                    <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                                        <h3 class="font-semibold text-lg">Đánh giá Tiếng Anh - Lớp 12A3</h3>
                                        <div class="flex items-center gap-4">
                                            <div>
                                                <label for="month-select-ta" class="text-sm font-medium mr-2">Chọn tháng:</label>
                                                <select id="month-select-ta" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                    <option>Tháng 8</option>
                                                    <option>Tháng 9</option>
                                                    <option>Tháng 10</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="week-select-ta" class="text-sm font-medium mr-2">Chọn tuần:</label>
                                                <select id="week-select-ta" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                    <option>Tuần 1 (19/08 - 23/08)</option>
                                                    <option>Tuần 2 (26/08 - 30/08)</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="group-filter-ta" class="text-sm font-medium mr-2">Lọc theo nhóm:</label>
                                                <select id="group-filter-ta" class="p-2 border rounded-md text-sm focus:ring-primary focus:border-primary">
                                                    <option value="all">Tất cả các nhóm</option>
                                                    <option value="1">Nhóm 1</option>
                                                    <option value="2">Nhóm 2</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm whitespace-nowrap">
                                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                                <tr>
                                                    <th rowspan="2" class="px-4 py-3 sticky-col bg-gray-50 align-middle">Học sinh</th>
                                                    <th colspan="2" class="px-4 py-3 text-center border-l border-gray-300">Vocabulary</th>
                                                    <th colspan="2" class="px-4 py-3 text-center border-l border-gray-300">Explore Language 1</th>
                                                    <th colspan="2" class="px-4 py-3 text-center border-l border-gray-300">Explore Language 2</th>
                                                    <th rowspan="2" class="px-4 py-3 align-middle border-l border-gray-300">Writing</th>
                                                </tr>
                                                <tr>
                                                    <th class="px-4 py-3 border-l border-gray-300">Listening</th>
                                                    <th class="px-4 py-3">Vocab</th>
                                                    <th class="px-4 py-3 border-l border-gray-300">Speaking</th>
                                                    <th class="px-4 py-3">Grammar 1</th>
                                                    <th class="px-4 py-3 border-l border-gray-300">Reading</th>
                                                    <th class="px-4 py-3">Grammar 2</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Lê An</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                                <tr class="border-b"><td class="px-4 py-2 sticky-col bg-white font-medium">Trần Bình</td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td><td><div class="star-rating flex justify-center"></div></td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                 </div>
                             </div>
                        </div>

                        <!-- Report Export Screen -->
                        <div id="report-export" class="screen">
                              <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                                 <div><h1 class="text-2xl font-bold text-dark">Tổng hợp và Xuất Báo cáo</h1><p class="text-light">Chọn học sinh để xem và xuất phiếu nhận xét.</p></div>
                                 <button class="btn-accent py-2 px-4 rounded-lg flex items-center space-x-2 mt-4 md:mt-0"><i data-lucide="printer" class="w-5 h-5"></i><span>In hoặc Lưu PDF</span></button>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    <!-- Student List -->
                                    <div class="lg:col-span-1 border-r pr-6">
                                        <h2 class="font-bold mb-4">Danh sách học sinh - Lớp 12A3</h2>
                                        <div class="space-y-2">
                                            <a href="#" class="block p-3 rounded-lg bg-blue-100 text-primary font-semibold">Lê An</a>
                                            <a href="#" class="block p-3 rounded-lg hover:bg-gray-100">Trần Bình</a>
                                            <a href="#" class="block p-3 rounded-lg hover:bg-gray-100">Phạm Cường</a>
                                        </div>
                                    </div>
                                    <!-- Report Preview -->
                                    <div class="lg:col-span-2">
                                        <div class="border rounded-lg p-6 aspect-[1/1.414] overflow-y-auto text-xs">
                                            <div class="text-center mb-4">
                                                <h3 class="font-bold text-base">HỆ THỐNG TRƯỜNG PATHWAY TUỆ ĐỨC</h3>
                                                <h4 class="font-bold text-sm">NHẬN XÉT THÁNG 9</h4>
                                                <p class="text-xs">Từ 19-08-2024 đến 27-09-2024</p>
                                            </div>
                                            <div class="flex justify-between mb-4">
                                                <p><strong>Họ và tên học sinh:</strong> Lê An</p>
                                                <p><strong>Lớp:</strong> 12A3</p>
                                            </div>
                                            
                                            <!-- Competencies & Qualities Table -->
                                            <table class="w-full border-collapse mb-4">
                                                <tr class="report-header"><td class="report-cell" colspan="3">ĐÁNH GIÁ NĂNG LỰC & PHẨM CHẤT (GVCN)</td></tr>
                                                <tr class="bg-gray-50 font-semibold">
                                                    <td class="report-cell w-1/3">Năng lực - Phẩm chất</td>
                                                    <td class="report-cell w-1/6 text-center">Xếp loại</td>
                                                    <td class="report-cell w-1/2">Nhận xét chi tiết</td>
                                                </tr>
                                                <tr><td class="report-cell">Tự phục vụ, tự quản</td><td class="report-cell text-center">Tốt</td><td class="report-cell">Con tự giác trong việc chuẩn bị bài vở và giữ gìn vệ sinh cá nhân.</td></tr>
                                                <tr><td class="report-cell">Hợp tác</td><td class="report-cell text-center">Tốt</td><td class="report-cell">Tích cực tham gia hoạt động nhóm, biết lắng nghe ý kiến bạn bè.</td></tr>
                                                <tr><td class="report-cell">Tự học và giải quyết vấn đề</td><td class="report-cell text-center">Khá</td><td class="report-cell">Cần chủ động hơn trong việc tìm tòi các cách giải quyết vấn đề mới.</td></tr>
                                            </table>

                                            <!-- Academic Subjects Table -->
                                            <table class="w-full border-collapse mb-4">
                                                <tr class="report-header"><td class="report-cell" colspan="3">ĐÁNH GIÁ MÔN HỌC VĂN HÓA (GVCN)</td></tr>
                                                <!-- Sub-section for Math -->
                                                <tr class="bg-gray-100 font-semibold"><td class="report-cell" colspan="3">Môn: Toán</td></tr>
                                                <tr><td class="report-cell pl-8 w-1/2">Tính toán nhanh và chính xác</td><td class="report-cell text-center w-1/6">Mức 3</td><td class="report-cell w-1/3">Con tính toán rất tốt.</td></tr>
                                                <tr><td class="report-cell pl-8">Bảng nhân, chia 2 và 5</td><td class="report-cell text-center">Mức 3</td><td class="report-cell">Thuộc và vận dụng thành thạo.</td></tr>
                                                <!-- Sub-section for Science -->
                                                <tr class="bg-gray-100 font-semibold"><td class="report-cell" colspan="3">Môn: Khoa học - Lịch sử - Địa lý</td></tr>
                                                <tr><td class="report-cell pl-8">Tên gọi và nơi sống của động, thực vật đặc trưng.</td><td class="report-cell text-center">Mức 2</td><td class="report-cell">Con nhận biết tốt, cần ghi nhớ thêm.</td></tr>
                                            </table>

                                            <!-- English Language Subjects Table -->
                                            <table class="w-full border-collapse mb-4">
                                                <tr class="report-header"><td class="report-cell" colspan="3">ĐÁNH GIÁ MÔN TIẾNG ANH (GVTA)</td></tr>
                                                <tr class="bg-gray-50 font-semibold">
                                                    <td class="report-cell w-1/3">Kỹ năng</td>
                                                    <td class="report-cell w-1/6 text-center">Mức độ</td>
                                                    <td class="report-cell w-1/2">Nhận xét</td>
                                                </tr>
                                                <tr><td class="report-cell">Vocabulary</td><td class="report-cell text-center">Tốt</td><td class="report-cell">Vốn từ vựng phong phú, sử dụng linh hoạt.</td></tr>
                                                <tr><td class="report-cell">Listening</td><td class="report-cell text-center">Khá</td><td class="report-cell">Nghe hiểu tốt các đoạn hội thoại đơn giản, cần luyện thêm với các chủ đề phức tạp hơn.</td></tr>
                                            </table>

                                            <!-- Skill Subjects Table -->
                                            <table class="w-full border-collapse">
                                                <tr class="report-header"><td class="report-cell" colspan="3">ĐÁNH GIÁ MÔN HỌC KỸ NĂNG (GVKN)</td></tr>
                                                <tr class="bg-gray-50 font-semibold">
                                                    <td class="report-cell w-1/3">Môn học</td>
                                                    <td class="report-cell w-1/6 text-center">Mức độ</td>
                                                    <td class="report-cell w-1/2">Nhận xét</td>
                                                </tr>
                                                <tr><td class="report-cell">Tin học</td><td class="report-cell text-center">Đạt</td><td class="report-cell">Thực hiện được các thao tác cơ bản theo hướng dẫn.</td></tr>
                                                <tr><td class="report-cell">Âm nhạc</td><td class="report-cell text-center">Tốt</td><td class="report-cell">Hăng hái tham gia các hoạt động, có năng khiếu.</td></tr>
                                            </table>

                                            <div class="mt-4 text-right text-[10px]">
                                                <p><strong>Đánh giá theo mức độ:</strong> Mức 3: Vận dụng, Mức 2: Thông hiểu, Mức 1: Nhận biết, Mức 0: Không tham gia</p>
                                                <p><strong>Đánh giá theo kết quả:</strong> T: Tốt, K: Khá, D: Đạt, C: Cần cố gắng</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- AUTHENTICATION SCREEN -->
    <div id="auth-screen" class="screen active min-h-screen flex items-center justify-center bg-light">
        <div class="w-full max-w-md">
            <!-- Login Form -->
            <div id="login-form" class="bg-white p-8 rounded-xl shadow-lg">
                <div class="flex justify-center mb-6">
                    <img src="logo.png" alt="School Logo" class="w-24 h-24">
                </div>
                <h2 class="text-2xl font-bold text-center text-dark">Đăng nhập hệ thống</h2>
                <p class="text-center text-light mb-8">Chào mừng bạn trở lại!</p>
                <form class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">Tên đăng nhập</label>
                        <input type="text" id="username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Mật khẩu</label>
                        <input type="password" id="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <button type="button" id="login-btn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg">Đăng nhập</button>
                </form>
                <div class="text-center mt-6">
                    <a href="#" id="show-register-form" class="text-sm font-medium text-primary hover:underline">Chưa có tài khoản? Đăng ký</a>
                </div>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="bg-white p-8 rounded-xl shadow-lg hidden">
                 <div class="flex justify-center mb-6">
                    <img src="logo.png" alt="School Logo" class="w-24 h-24">
                 </div>
                <h2 class="text-2xl font-bold text-center text-dark">Đăng ký tài khoản</h2>
                <p class="text-center text-light mb-8">Điền thông tin để tạo tài khoản mới.</p>
                <form class="space-y-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Họ và tên</label>
                            <input type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Chức vụ</label>
                            <select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option>QTV/Ban giám hiệu</option>
                                <option>Chuyên môn</option>
                                <option>Giáo viên Chủ nhiệm</option>
                                <option>Giáo viên Tiếng Anh</option>
                                <option>Giáo viên Kỹ năng</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Số điện thoại</label>
                            <input type="tel" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Giới tính</label>
                             <select class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option>Nam</option>
                                <option>Nữ</option>
                                <option>Khác</option>
                            </select>
                        </div>
                    </div>
                     <div>
                        <label class="block text-sm font-medium text-gray-700">Tên đăng nhập</label>
                        <input type="text" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Mật khẩu</label>
                        <input type="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Mã đăng ký</label>
                        <div class="flex items-center space-x-2 mt-1">
                            <input type="text" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                            <button type="button" class="btn-accent px-4 py-2 rounded-md text-sm font-medium whitespace-nowrap">Gửi mã</button>
                        </div>
                    </div>
                    <button type="button" class="w-full btn-primary font-bold py-3 px-4 rounded-lg">Đăng ký</button>
                </form>
                <div class="text-center mt-6">
                    <a href="#" id="show-login-form" class="text-sm font-medium text-primary hover:underline">Đã có tài khoản? Đăng nhập</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODALS -->
    <div id="import-student-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"><div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl"><h2 class="text-xl font-bold mb-6">Import Danh sách Học sinh từ Excel</h2><ol class="flex items-center w-full space-x-4 mb-8"><li class="flex-1 flex items-center text-primary font-semibold"><span class="flex items-center justify-center w-8 h-8 rounded-full bg-primary text-white mr-3">1</span>Tải file mẫu</li><li class="flex-1 flex items-center text-gray-400"><div class="w-full h-0.5 bg-gray-200"></div><span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-200 text-gray-500 mx-3">2</span>Tải lên file</li><li class="flex-1 flex items-center text-gray-400"><div class="w-full h-0.5 bg-gray-200"></div><span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-200 text-gray-500 ml-3">3</span>Xác nhận</li></ol><div><h3 class="text-lg font-semibold mb-2">Bước 1: Tải về file mẫu</h3><p class="text-light mb-4">Sử dụng file mẫu để đảm bảo dữ liệu được định dạng chính xác. Không thay đổi tên các cột trong file.</p><button class="btn-primary py-2 px-4 rounded-lg flex items-center space-x-2"><i data-lucide="download" class="w-5 h-5"></i><span>Tải file mẫu (.xlsx)</span></button><hr class="my-6"><h3 class="text-lg font-semibold mb-2 text-gray-400">Bước 2: Chọn và tải lên file của bạn</h3><p class="text-light mb-4">Kéo thả hoặc chọn file Excel đã được điền thông tin.</p><div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center bg-gray-50"><p class="text-gray-500">Chức năng tải lên sẽ được kích hoạt ở bước tiếp theo.</p></div></div><div class="flex justify-end space-x-3 mt-8"><button class="cancel-modal-btn px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Đóng</button></div></div></div>

    <!-- Add/Edit Modal -->
    <div id="add-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h3 id="modal-title" class="text-lg font-bold mb-4">Modal Title</h3>
            <form id="modal-form" class="space-y-4">
                <!-- Form content will be injected here by JavaScript -->
            </form>
            <div class="flex justify-end space-x-3 mt-6">
                <button class="cancel-modal-btn px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Hủy</button>
                <button class="btn-primary px-4 py-2 rounded-lg">Lưu</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                    <i data-lucide="alert-triangle" class="h-6 w-6 text-red-600"></i>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-3">Xóa mục này?</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500">Bạn có chắc chắn muốn xóa mục đã chọn? Hành động này không thể được hoàn tác.</p>
                </div>
                <div class="flex justify-center space-x-3 mt-4">
                    <button class="cancel-modal-btn px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Hủy</button>
                    <button class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">Xác nhận Xóa</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- INITIALIZATION ---
        lucide.createIcons();

        // --- DOM ELEMENTS ---
        const appContainer = document.getElementById('app-container');
        const authScreen = document.getElementById('auth-screen');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterLink = document.getElementById('show-register-form');
        const showLoginLink = document.getElementById('show-login-form');
        
        const allScreens = document.querySelectorAll('.screen');
        const sidebarNav = document.getElementById('sidebar-nav');
        const roleMenus = document.querySelectorAll('.role-menu');
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-button');

        const userNameEl = document.getElementById('user-name');
        const userRoleEl = document.getElementById('user-role');
        const adminSwitcher = document.getElementById('admin-switcher');
        
        const userMenuButton = document.getElementById('user-menu-button');
        const userMenu = document.getElementById('user-menu');

        // Modals
        const addEditModal = document.getElementById('add-edit-modal');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const importStudentBtn = document.getElementById('import-student-btn');
        const cancelModalBtns = document.querySelectorAll('.cancel-modal-btn');

        // Modal Form
        const modalTitle = document.getElementById('modal-title');
        const modalForm = document.getElementById('modal-form');
        
        // Academic Year Elements
        const yearList = document.getElementById('year-list');
        const selectedYearTitle = document.getElementById('selected-year-title');
        
        // Class Setup Elements
        const gvknClassFilter = document.getElementById('gvkn-class-filter');
        const gvknClassSelect = document.getElementById('gvkn-class-select');
        const classSetupTitle = document.getElementById('class-setup-title');
        const classSetupContent = document.getElementById('class-setup-content');

        // GVKN Evaluation
        const skillSubjectFilter = document.getElementById('skill-subject-filter');
        const skillEvaluationContent = document.getElementById('skill-evaluation-content');
        const skillEvaluationSubjectTitle = document.getElementById('skill-evaluation-subject-title');
        
        // GVCN Academic Evaluation
        const academicSubjectFilter = document.getElementById('academic-subject-filter');
        const academicEvaluationContent = document.getElementById('academic-evaluation-content');
        const academicEvaluationSubjectTitle = document.getElementById('academic-evaluation-subject-title');


        // --- STATE ---
        let currentUserRole = null; // 'admin', 'teacher', or 'skill_teacher'
        let adminCharts = {}; // To hold chart instances

        // --- MODAL FORM TEMPLATES ---
        const formTemplates = {
            student: `
                <div><label class="block text-sm font-medium">Mã học sinh</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Họ và tên</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Ngày sinh</label><input type="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Lớp</label><select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"><option>10A1</option><option>10A2</option></select></div>
                <div><label class="block text-sm font-medium">Ghi chú</label><textarea class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></textarea></div>
            `,
            class: `
                <div><label class="block text-sm font-medium">Tên lớp</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Giáo viên chủ nhiệm</label><select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"><option>Nguyễn Thị C</option><option>Lê Văn D</option></select></div>
            `,
            teacher: `
                <div><label class="block text-sm font-medium">Họ và tên</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Email</label><input type="email" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Vai trò</label><select class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"><option>GVCN</option><option>GVTA</option><option>GVKN</option></select></div>
            `,
            facility: `
                <div><label class="block text-sm font-medium">Tên cơ sở</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Địa chỉ</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Số điện thoại</label><input type="tel" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
            `,
            year: `
                <div><label class="block text-sm font-medium">Tên năm học</label><input type="text" placeholder="Ví dụ: 2024 - 2025" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
            `,
            term: `
                <div><label class="block text-sm font-medium">Tên kỳ đánh giá</label><input type="text" placeholder="Ví dụ: Đánh giá tháng 9" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Ngày bắt đầu</label><input type="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
                <div><label class="block text-sm font-medium">Ngày kết thúc</label><input type="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
            `,
            academic_subject: `
                <div><label class="block text-sm font-medium">Tên Môn học Văn hóa</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
            `,
            subject_criteria: `
                <div><label class="block text-sm font-medium">Tên Tiêu chí</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
            `,
            skill_subject: `
                <div><label class="block text-sm font-medium">Tên Môn học Kỹ năng</label><input type="text" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></div>
            `
        };

        // --- FUNCTIONS ---
        function showScreen(screenId) {
            allScreens.forEach(screen => screen.classList.remove('active'));
            const activeScreen = document.getElementById(screenId);
            if (activeScreen) activeScreen.classList.add('active');

            sidebarLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.screen === screenId);
            });
        }
        
        function toggleReadOnly(isReadOnly) {
            const elementsToDisable = document.querySelectorAll('.add-new-btn, .edit-btn, .delete-btn, #import-student-btn, #modal-form button, .evaluation-view textarea, .evaluation-view button[data-lucide="message-square-plus"]');
            
            elementsToDisable.forEach(el => {
                el.disabled = isReadOnly;
                el.classList.toggle('disabled-ui', isReadOnly);
            });

            const selectsToDisable = document.querySelectorAll('.evaluation-view select');
             selectsToDisable.forEach(el => {
                // Keep filters enabled
                if (!el.id.includes('-filter') && !el.id.includes('-select')) {
                    el.disabled = isReadOnly;
                    el.classList.toggle('disabled-ui', isReadOnly);
                }
            });
        }

        function setupUIForRole(role) {
            roleMenus.forEach(menu => {
                const roles = menu.dataset.role.split(' ');
                menu.style.display = roles.includes(role) ? 'block' : 'none';
            });
            
            const firstLink = document.querySelector(`.sidebar-link[data-role*='${role}']`);
            if (firstLink) {
                let screenId = firstLink.dataset.screen;
                 if (role === 'admin' || role === 'chuyen_mon') {
                    screenId = 'dashboard';
                }
                showScreen(screenId);
            }
        }
        
        function initAdminCharts() {
            // Destroy existing charts if they exist to prevent duplicates
            Object.values(adminCharts).forEach(chart => chart.destroy());
            adminCharts = {};

            // Chart 1: Evaluation by Class (Grouped Bar)
            const ctx1 = document.getElementById('evaluationByClassChart').getContext('2d');
            adminCharts.evaluationByClass = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Lớp 10A1', 'Lớp 10A2', 'Lớp 11B1', 'Lớp 11B2', 'Lớp 12C1'],
                    datasets: [{
                        label: 'Tốt', data: [15, 18, 22, 19, 25], backgroundColor: 'rgba(75, 192, 192, 0.7)'
                    }, {
                        label: 'Khá', data: [20, 15, 12, 18, 10], backgroundColor: 'rgba(54, 162, 235, 0.7)'
                    }, {
                        label: 'Cần cố gắng', data: [5, 7, 3, 4, 2], backgroundColor: 'rgba(255, 99, 132, 0.7)'
                    }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true, title: { display: true, text: 'Số lượng học sinh' } } }, plugins: { legend: { position: 'top' } } }
            });

            // Chart 2: Classes per Teacher (Horizontal Bar)
            const ctx2 = document.getElementById('classesPerTeacherChart').getContext('2d');
            adminCharts.classesPerTeacher = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Nguyễn Thị C', 'Lê Văn D', 'Trần Minh E', 'Phạm Thị F', 'Hoàng Văn G'],
                    datasets: [{
                        label: 'Số lớp chủ nhiệm', data: [2, 3, 2, 4, 3], backgroundColor: 'rgba(255, 159, 64, 0.7)'
                    }]
                },
                options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } }, scales: { x: { title: { display: true, text: 'Số lớp' } } } }
            });

            // Chart 3: Students per Teacher (Doughnut)
            const ctx3 = document.getElementById('studentsPerTeacherChart').getContext('2d');
            adminCharts.studentsPerTeacher = new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: ['Nguyễn Thị C', 'Lê Văn D', 'Trần Minh E', 'Phạm Thị F', 'Hoàng Văn G'],
                    datasets: [{
                        label: 'Số học sinh', data: [90, 120, 85, 150, 110],
                        backgroundColor: ['rgba(255, 99, 132, 0.8)', 'rgba(54, 162, 235, 0.8)', 'rgba(255, 206, 86, 0.8)', 'rgba(75, 192, 192, 0.8)', 'rgba(153, 102, 255, 0.8)'],
                        hoverOffset: 4
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'right' } } }
            });

            // Chart 4: Evaluation by Teacher (Stacked Bar)
            const ctx4 = document.getElementById('evaluationByTeacherChart').getContext('2d');
            adminCharts.evaluationByTeacher = new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: ['Nguyễn Thị C', 'Lê Văn D', 'Trần Minh E', 'Phạm Thị F', 'Hoàng Văn G'],
                    datasets: [{
                        label: 'Tốt', data: [60, 80, 70, 100, 90], backgroundColor: 'rgba(75, 192, 192, 0.7)'
                    }, {
                        label: 'Khá', data: [25, 30, 10, 40, 15], backgroundColor: 'rgba(54, 162, 235, 0.7)'
                    }, {
                        label: 'Cần cố gắng', data: [5, 10, 5, 10, 5], backgroundColor: 'rgba(255, 99, 132, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, stacked: true, title: { display: true, text: 'Số lượng học sinh' } },
                        x: { stacked: true }
                    },
                    plugins: { legend: { position: 'top' } }
                }
            });
        }


        function login(role) {
            currentUserRole = role;
            appContainer.classList.remove('hidden');
            authScreen.classList.remove('active');
            authScreen.classList.add('hidden');

            adminSwitcher.style.display = 'none';
            document.querySelectorAll('.evaluation-view').forEach(v => v.classList.add('hidden'));
            gvknClassFilter.classList.add('hidden');
            classSetupContent.classList.add('hidden');
            toggleReadOnly(false); // Reset to default

            if (role === 'admin') {
                userNameEl.textContent = 'Trần Minh Tuấn';
                userRoleEl.textContent = 'QTV / BGH';
                adminSwitcher.style.display = 'flex';
                setTimeout(initAdminCharts, 0); 
            } else if (role === 'chuyen_mon') {
                userNameEl.textContent = 'Phạm Văn Khoa';
                userRoleEl.textContent = 'Chuyên môn';
                adminSwitcher.style.display = 'flex';
                setTimeout(initAdminCharts, 0); 
                toggleReadOnly(true);
            } else if (role === 'teacher') {
                userNameEl.textContent = 'Nguyễn Văn A';
                userRoleEl.textContent = 'GVCN';
                document.getElementById('gvcn-evaluation-view').classList.remove('hidden');
                classSetupTitle.textContent = 'Thiết lập Lớp học - 12A3';
                classSetupContent.classList.remove('hidden');
            } else if (role === 'skill_teacher') {
                userNameEl.textContent = 'Phan Anh Tuấn';
                userRoleEl.textContent = 'GV Kỹ năng';
                document.getElementById('gvkn-evaluation-view').classList.remove('hidden');
                gvknClassFilter.classList.remove('hidden');
                classSetupTitle.textContent = 'Thiết lập Lớp học';
            } else if (role === 'teacher_english') {
                userNameEl.textContent = 'Trần Thị B';
                userRoleEl.textContent = 'GV Tiếng Anh';
                document.getElementById('gvta-evaluation-view').classList.remove('hidden');
                classSetupTitle.textContent = 'Thiết lập Lớp học - 12A3';
                classSetupContent.classList.remove('hidden');
            }
            setupUIForRole(role);
        }

        function logout() {
            currentUserRole = null;
            appContainer.classList.add('hidden');
            authScreen.classList.add('active');
            authScreen.classList.remove('hidden');
            showScreen('auth-screen');
            toggleReadOnly(false);
            // Destroy charts on logout
            Object.values(adminCharts).forEach(chart => chart.destroy());
            adminCharts = {};
        }

        function openAddEditModal(type, mode = 'add', data = {}) {
            const titles = {
                student: 'Học sinh',
                class: 'Lớp học',
                teacher: 'Giáo viên',
                facility: 'Cơ sở',
                year: 'Năm học',
                term: 'Kỳ đánh giá',
                skill_subject: 'Môn học Kỹ năng',
                academic_subject: 'Môn học Văn hóa',
                subject_criteria: 'Tiêu chí Môn học'
            };
            modalTitle.textContent = `${mode === 'add' ? 'Thêm mới' : 'Chỉnh sửa'} ${titles[type]}`;
            modalForm.innerHTML = formTemplates[type];
            addEditModal.classList.remove('hidden');
        }

        function handleStarRating(e) {
            const star = e.target.closest('.star');
            if (!star) return;

            const ratingContainer = star.parentElement;
            const value = parseInt(star.dataset.value, 10);
            const currentValue = parseInt(ratingContainer.dataset.rating, 10);
            
            const newRating = currentValue === value ? 0 : value;
            
            ratingContainer.dataset.rating = newRating;

            ratingContainer.classList.remove('rating-1', 'rating-2', 'rating-3');
            if (newRating > 0) {
                ratingContainer.classList.add(`rating-${newRating}`);
            }
        }

        // --- EVENT LISTENERS ---
        loginBtn.addEventListener('click', () => {
            // Dummy login logic
            // In a real app, you'd validate credentials and get the role from the server
            const username = document.getElementById('username').value;
            if (username.includes('admin')) login('admin');
            else if (username.includes('chuyenmon')) login('chuyen_mon');
            else if (username.includes('gvcn')) login('teacher');
            else if (username.includes('gvta')) login('teacher_english');
            else if (username.includes('gvkn')) login('skill_teacher');
            else login('teacher'); // default
        });
        
        logoutBtn.addEventListener('click', logout);

        showRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
        });

        showLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        sidebarNav.addEventListener('click', (e) => {
            e.preventDefault();
            const link = e.target.closest('.sidebar-link');
            if (link) {
                const screenId = link.dataset.screen;
                if(screenId === 'dashboard') {
                    showScreen('dashboard-admin');
                } else {
                    showScreen(screenId);
                }
            }
        });

        userMenuButton.addEventListener('click', () => userMenu.classList.toggle('hidden'));
        window.addEventListener('click', (e) => {
            if (!userMenuButton.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });
        
        // Delegated event listener for CRUD actions and tabs
        appContainer.addEventListener('click', (e) => {
            const target = e.target;
            const addNewBtn = target.closest('.add-new-btn');
            if (addNewBtn) {
                openAddEditModal(addNewBtn.dataset.type, 'add');
                return;
            }

            const editBtn = target.closest('.edit-btn');
            if (editBtn) {
                openAddEditModal(editBtn.dataset.type, 'edit');
                return;
            }

            const deleteBtn = target.closest('.delete-btn');
            if (deleteBtn) {
                deleteConfirmModal.classList.remove('hidden');
                return;
            }
            
            // Tab switching logic
            const tabButton = target.closest('.tab-button');
            if (tabButton) {
                 const tabContainer = tabButton.parentElement;
                 if (!tabContainer) return;

                 const tabPanelContainer = tabContainer.parentElement.parentElement;
                 
                 tabContainer.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                 tabButton.classList.add('active');
                 
                 tabPanelContainer.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
                 const targetPanel = document.getElementById(tabButton.dataset.tab);
                 if (targetPanel) {
                    targetPanel.classList.add('active');
                 }
            }
        });

        // Modal Listeners
        if (importStudentBtn) {
            importStudentBtn.addEventListener('click', () => {
                document.getElementById('import-student-modal').classList.remove('hidden');
            });
        }
        cancelModalBtns.forEach(b => b.addEventListener('click', () => {
            b.closest('.fixed').classList.add('hidden');
        }));
        
        // Academic Year List Interaction
        if (yearList) {
            yearList.addEventListener('click', (e) => {
                const yearItem = e.target.closest('.year-item');
                if (yearItem && !e.target.closest('button')) { // Prevent firing when clicking edit/delete
                    yearList.querySelectorAll('.year-item').forEach(item => item.classList.remove('active'));
                    yearItem.classList.add('active');
                    const yearText = yearItem.querySelector('span').textContent;
                    if(selectedYearTitle) {
                        selectedYearTitle.textContent = yearText;
                    }
                }
            });
        }
        
        // GVKN Class Filter
        gvknClassSelect.addEventListener('change', (e) => {
            const selectedClass = e.target.value;
            if (selectedClass) {
                classSetupTitle.textContent = `Thiết lập Lớp học - ${selectedClass}`;
                classSetupContent.classList.remove('hidden');
            } else {
                classSetupTitle.textContent = 'Thiết lập Lớp học';
                classSetupContent.classList.add('hidden');
            }
        });

        // GVKN Subject Filter
        skillSubjectFilter.addEventListener('change', (e) => {
            const selectedSubjectValue = e.target.value;
            const selectedSubjectText = e.target.options[e.target.selectedIndex].text;

            if (selectedSubjectValue) {
                skillEvaluationSubjectTitle.textContent = `Bảng đánh giá môn: ${selectedSubjectText}`;
                skillEvaluationContent.classList.remove('hidden');
            } else {
                skillEvaluationContent.classList.add('hidden');
            }
        });
        
        // GVCN Academic Subject Filter
        academicSubjectFilter.addEventListener('change', (e) => {
            const selectedSubjectValue = e.target.value;
            const selectedSubjectText = e.target.options[e.target.selectedIndex].text;

            document.querySelectorAll('.academic-subject-table').forEach(table => {
                table.classList.add('hidden');
            });

            if (selectedSubjectValue) {
                academicEvaluationSubjectTitle.textContent = `Bảng đánh giá môn: ${selectedSubjectText}`;
                const tableToShow = document.getElementById(`academic-table-${selectedSubjectValue}`);
                if(tableToShow) {
                    tableToShow.classList.remove('hidden');
                }
                academicEvaluationContent.classList.remove('hidden');
            } else {
                academicEvaluationContent.classList.add('hidden');
            }
        });

        // Star Rating Initialization and Event Handling
        document.querySelectorAll('.star-rating').forEach(ratingContainer => {
            for (let i = 1; i <= 3; i++) {
                const starSpan = document.createElement('span');
                starSpan.classList.add('star');
                starSpan.dataset.value = i;
                starSpan.innerHTML = `<i data-lucide="star" class="w-5 h-5 fill-current"></i>`;
                ratingContainer.appendChild(starSpan);
            }
            ratingContainer.dataset.rating = 0;
            ratingContainer.addEventListener('click', handleStarRating);
        });
        lucide.createIcons(); // Re-run to create new star icons

        // --- INITIAL SETUP ---
        showScreen('auth-screen');
    </script>
</body>
</html>
